import{resolve as E}from"path";import{createFilter as S}from"@rollup/pluginutils";var d="vite-eslint-plugin";import{existsSync as O}from"fs";function g(e){return e.split("?",2)[0]}function h(e){return!O(e)}function y(e){let{eslintPath:i,lintOnStart:f,include:o,exclude:t,formatter:c,failOnError:a,failOnWarning:r,...p}=e;return p}async function u(e){return e.then(i=>[null,i]).catch(i=>[i,void 0])}async function m(e,i,f,o,t,c){let[a,r]=await u(i.lintFiles(f));if(a)return Promise.reject(a);if(o.fix&&r){let[l]=await u(c(r));if(l)return Promise.reject(l)}let p=r.some(l=>l.warningCount>0),n=r.some(l=>l.errorCount>0),s=await t(r);return s!=null&&s.length&&(console.log(""),e.warn("\u{1F4C3} ESLint problems"),console.log(s)),p&&o.failOnWarning?e.error("\u{1F6A8} Check console for ESLint warning(s) \u{1F446}"):n&&o.failOnError?e.error("\u{1F6A8} Check console for ESLint error(s) \u{1F446}"):Promise.resolve()}function v(e={}){let i,f,o,t,c,a=new Set;return{name:d,async configResolved(r){t={lintOnStart:!1,include:["**/*.js","**/*.jsx","**/*.ts","**/*.tsx","**/*.vue","**/*.svelte"],exclude:["**/node_modules/**"],cacheLocation:E(r.cacheDir,".eslintcache"),formatter:"stylish",failOnWarning:!1,failOnError:!0,errorOnUnmatchedPattern:!1,...e}},async buildStart(){let[r,p]=await u(import(t.eslintPath??"eslint"));if(r)this.error("Failed to import ESLint, do you install or configure eslintPath?");else{let n=y(t);switch(i=new p.ESLint(n),c=p.ESLint.outputFixes,f=S(t.include,t.exclude),typeof t.formatter){case"string":o=(await i.loadFormatter(t.formatter)).format;break;case"function":o=t.formatter;break;default:break}if(t.lintOnStart&&t.include){let[s]=await u(m(this,i,t.include,t,o,c));s&&this.error(s.message)}}},async transform(r,p){let n=g(p),s=h(n);if(s&&a.has(n)&&a.delete(n),!f(n)||await i.isPathIgnored(n)||s)return null;t.cache&&a.add(n);let[l]=await u(m(this,i,t.cache?Array.from(a):n,t,o,c));return l&&this.error(l.message),null}}}export{v as default};
